
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Configure LogDNA Agent Â· Bring it all together on OpenShift 4.3 on IBM Cloud</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="exercise-8.html" />
    
    
    <link rel="prev" href="exercise-6.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../getting-started/get_started.html">
            
                <a href="../getting-started/get_started.html">
            
                    
                        <b>2.1.</b>
                    
                    Create Account and Get Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../getting-started/setup_cli.html">
            
                <a href="../getting-started/setup_cli.html">
            
                    
                        <b>2.2.</b>
                    
                    Configure Shell Access
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Learning OpenShift 4.3</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../part1-learn_openshift/exercise-1.html">
            
                <a href="../part1-learn_openshift/exercise-1.html">
            
                    
                        <b>3.1.</b>
                    
                    Deploying an App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../part1-learn_openshift/exercise-2.html">
            
                <a href="../part1-learn_openshift/exercise-2.html">
            
                    
                        <b>3.2.</b>
                    
                    Logging and Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../part1-learn_openshift/exercise-3.html">
            
                <a href="../part1-learn_openshift/exercise-3.html">
            
                    
                        <b>3.3.</b>
                    
                    Metrics and Dashboards
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../part1-learn_openshift/exercise-4.html">
            
                <a href="../part1-learn_openshift/exercise-4.html">
            
                    
                        <b>3.4.</b>
                    
                    Scaling the App
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">OpenShift 4.3 and IBM Cloud</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="exercise-5.html">
            
                <a href="exercise-5.html">
            
                    
                        <b>4.1.</b>
                    
                    Cloudant with OperatorHub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="exercise-6.html">
            
                <a href="exercise-6.html">
            
                    
                        <b>4.2.</b>
                    
                    Configure Sysdig Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.3" data-path="exercise-7.html">
            
                <a href="exercise-7.html">
            
                    
                        <b>4.3.</b>
                    
                    Configure LogDNA Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="exercise-8.html">
            
                <a href="exercise-8.html">
            
                    
                        <b>4.4.</b>
                    
                    Analyze Logs w/ LogDNA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="exercise-9.html">
            
                <a href="exercise-9.html">
            
                    
                        <b>4.5.</b>
                    
                    Monitor Cluster w/ SysDig
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <a target="_blank" href="https://developer.ibm.com">
            
                    
                        <b>5.1.</b>
                    
                    IBM Developer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" >
            
                <a target="_blank" href="https://cloud.ibm.com/docs/openshift">
            
                    
                        <b>5.2.</b>
                    
                    Docs: Red Hat OpenShift on IBM Cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" >
            
                <a target="_blank" href="https://docs.openshift.com/container-platform/4.3/welcome/index.html">
            
                    
                        <b>5.3.</b>
                    
                    Docs: OpenShift Container Platform 4.3
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Configure LogDNA Agent</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="configure-the-logdna-agent">Configure the LogDNA agent</h1>
<p>The LogDNA agent is responsible for collecting and forwarding logs to your IBM Log Analysis with LogDNA instance. After you provision an instance of IBM Log Analysis with LogDNA, you must configure a LogDNA agent for each log source that you want to monitor.</p>
<p>To configure your Kubernetes cluster to send logs to your IBM Log Analysis with LogDNA instance, you must install a <em>LogDNA-agent</em> pod on each node of your cluster. The LogDNA agent reads log files from the pod where it is installed, and forwards the log data to your LogDNA instance.</p>
<p>To forward logs to your LogDNA instance, complete the following steps from the command line:</p>
<h2 id="step-1-get-the-ingestion-key">Step 1. Get the ingestion key</h2>
<ol>
<li><p>In IBM Cloud Console, open the menu with the burger icon in the top left corner and select <strong>Observability</strong>. This will open the <a href="https://cloud.ibm.com/observe/monitoring" target="_blank">Observability</a>. Select <strong>Logging</strong>. </p>
<p>      <a href="../assets/icp-logging.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="../assets/icp-logging.png" alt="">
     </a>.</p>
<p> The list of instances that are available on IBM Cloud is displayed.</p>
</li>
<li><p>Select your instance or the one given by the instructor.</p>
</li>
<li><p>Select the three dots and click <strong>View key</strong>.</p>
<p>      <a href="../assets/icp-logging-key.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="../assets/icp-logging-key.png" alt="">
     </a></p>
</li>
<li><p>Copy the ingestion key.</p>
</li>
</ol>
<h2 id="step-2-store-your-logdna-ingestion-key-as-a-kubernetes-secret">Step 2. Store your LogDNA ingestion key as a Kubernetes secret</h2>
<p>You must create a Kubernetes secret to store your LogDNA ingestion key for your service instance. The LogDNA ingestion key is used to open a secure web socket to the LogDNA ingestion server and to authenticate the logging agent with the IBM Log Analysis with LogDNA service.</p>
<ol>
<li><p>Create a project. A project is a namespace in a cluster.</p>
<pre class="language-"><code> oc adm new-project --node-selector=&apos;&apos; ibm-observe
</code></pre><p> Set <code>--node-selector=&apos;&apos;</code> to disable the default project-wide node selector in your namespace and avoid pod recreates on the nodes that got unselected by the merged node selector.</p>
</li>
<li><p>Create the service account <strong>logdna-agent</strong> in the cluster namespace <strong>ibm-observe</strong>. A service account is in Openshift what a service ID is in IBM Cloud. Run the following command:</p>
<pre class="language-"><code> oc create serviceaccount logdna-agent -n ibm-observe
</code></pre></li>
<li><p>Grant the serviceaccount access to the <strong>Privileged SCC</strong> so the service account has permissions to create priviledged LogDNA pods. Run the following command:</p>
<pre class="language-"><code class="lang-sh"> oc adm policy add-scc-to-user privileged system:serviceaccount:ibm-observe:logdna-agent
</code></pre>
</li>
<li><p>Add a secret. The secret sets the ingestion key that the LogDNA agent uses to send logs.</p>
<pre class="language-"><code class="lang-sh"> oc create secret generic logdna-agent-key --from-literal<span class="token operator">=</span>logdna-agent-key<span class="token operator">=</span>INGESTION_KEY -n ibm-observe
</code></pre>
<p> Where <code>INGESTION_KEY</code> is the ingestion key for the LogDNA instance where you plan to forward and collect the cluster logs.</p>
</li>
</ol>
<h2 id="step-3-deploy-the-logdna-agent-in-the-cluster">Step 3. Deploy the LogDNA agent in the cluster</h2>
<p>Create a Kubernetes daemon set to deploy the LogDNA agent on every worker node of your Kubernetes cluster. </p>
<p>The LogDNA agent collects logs with the extension <code>*.log</code> and extensionsless files that are stored in the <code>/var/log</code> directory of your pod. By default, logs are collected from all namespaces, including <code>kube-system</code>, and automatically forwarded to the IBM Log Analysis with LogDNA service.</p>
<p>Run the following command if you are working on a LogDNA instance that is located in <strong>US-South</strong>:</p>
<pre class="language-"><code class="lang-sh">oc create -f https://assets.us-south.logging.cloud.ibm.com/clients/logdna-agent-ds-os.yaml -n ibm-observe
</code></pre>
<p>Run the following command if you are working on a LogDNA instance that is located in <strong>Frankfurt</strong>:</p>
<pre class="language-"><code class="lang-sh">oc create -f https://assets.eu-de.logging.cloud.ibm.com/clients/logdna-agent-ds-os.yaml -n ibm-observe
</code></pre>
<h2 id="step-4-verify-that-the-logdna-agent-is-deployed-successfully">Step 4. Verify that the LogDNA agent is deployed successfully</h2>
<p>To verify that the LogDNA agent is deployed successfully, run the following command:</p>
<ol>
<li><p>Target the project where the LogDNA agent is deployed.</p>
<pre class="language-"><code> oc project ibm-observe
</code></pre></li>
<li><p>Verify that the <code>logdna-agent</code> pods on each node are in a <strong>Running</strong> status.</p>
<pre class="language-"><code> oc get pods -n ibm-observe
</code></pre></li>
</ol>
<pre class="language-"><code>The deployment is successful when you see one or more LogDNA pods.
* **The number of LogDNA pods equals the number of worker nodes in your cluster.**
* All pods must be in a `Running` state.
* *Stdout* and *stderr* are automatically collected and forwarded from all containers. Log data includes application logs and worker logs.
* By default, the LogDNA agent pod that runs on a worker collects logs from all namespaces on that node.

After the agent is configured, you should start seeing logs from this cluster in the LogDNA web UI. If after a period of time you cannot see logs, check the agent logs.
</code></pre><ol>
<li><p>To check the logs that are generated by a LogDNA agent, run the following command:</p>
<pre class="language-"><code> oc logs logdna-agent-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">&gt;</span></span>
</code></pre><p> Where <em>ID</em> is the ID for a LogDNA agent pod. </p>
<p> For example, </p>
<pre class="language-"><code> oc logs logdna-agent-xxxkz
</code></pre></li>
</ol>
<h2 id="step-5-launch-the-logdna-web-ui-to-verify-that-logs-are-being-forwarded-from-the-logdna-agent">Step 5. Launch the LogDNA web UI to verify that logs are being forwarded from the LogDNA agent</h2>
<ol>
<li><p>Select <strong>Launch LogDNA</strong>.</p>
</li>
<li><p>In the <strong>Views</strong> page, click <strong>Everything</strong> to verify that logs from the cluster are available through the UI. </p>
</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="exercise-6.html" class="navigation navigation-prev " aria-label="Previous page: Configure Sysdig Agent">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="exercise-8.html" class="navigation navigation-next " aria-label="Next page: Analyze Logs w/ LogDNA">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Configure LogDNA Agent","level":"4.3","depth":1,"next":{"title":"Analyze Logs w/ LogDNA","level":"4.4","depth":1,"path":"part2-openshift_ibmcloud/exercise-8.md","ref":"part2-openshift_ibmcloud/exercise-8.md","articles":[]},"previous":{"title":"Configure Sysdig Agent","level":"4.2","depth":1,"path":"part2-openshift_ibmcloud/exercise-6.md","ref":"part2-openshift_ibmcloud/exercise-6.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header","codetabs"],"root":"workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"Bring it all together on OpenShift 4.3 on IBM Cloud"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"codetabs":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Bring it all together on OpenShift 4.3 on IBM Cloud","gitbook":"3.2.3"},"file":{"path":"part2-openshift_ibmcloud/exercise-7.md","mtime":"2020-01-28T22:30:21.259Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-28T22:32:09.958Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

